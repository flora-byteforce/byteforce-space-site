<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plaid OAuth Return</title>

  <!-- Same CSP to allow reCAPTCHA and Plaid -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    connect-src https://*.plaid.com https://*.plaid.io https://www.google.com https://www.gstatic.com;
    script-src 'self' 'unsafe-inline' https://*.plaid.com https://www.google.com https://www.gstatic.com;
    frame-src https://*.plaid.com https://www.google.com;
    img-src 'self' data: https://www.google.com https://www.gstatic.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://www.gstatic.com;
  ">
  <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
  </style>
</head>
<body>
  <p>Resuming bank connectionâ€¦</p>
  <script>
    // Use the exact same token as link.html
    const LINK_TOKEN = "link-production-ad0c36ad-6657-4cc5-b6c6-be2c286ce953";

    const handler = Plaid.create({
      token: LINK_TOKEN,
      // Important for OAuth resume on web:
      receivedRedirectUri: window.location.href
    });

    handler.open();

    // Optional logging
    handler._options.onEvent = (eventName, metadata) => {
      console.log("Link event (redirect):", eventName, metadata);
    };
    handler._options.onExit = (err, metadata) => {
      console.log("EXIT (redirect) err:", err);
      console.log("EXIT (redirect) metadata:", metadata);
      if (metadata?.link_session_id) console.log("link_session_id:", metadata.link_session_id);
    };
  </script>
</body>
</html>
